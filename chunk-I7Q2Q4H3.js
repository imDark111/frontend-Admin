import{Aa as k,Bb as Q,Ea as G,Fa as N,H as b,I as v,Ja as L,K as E,La as z,N as C,Na as V,O as y,Ra as W,Ya as q,Za as A,e as I,ea as S,f as _,ha as P,hb as J,k as o,l as F,m as x,ma as $,mb as K,n as m,na as O,o as l,oa as M,p as a,pa as U,q as i,qa as T,r as d,ra as j,sa as w,t as g,u as p,ua as D,w as u,x as h,xa as B,y as f,ya as H,za as R}from"./chunk-B4HSYOOP.js";import"./chunk-MWWENCHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-JV5DO3IJ.js";import"./chunk-L3SNWROS.js";import"./chunk-EYYNAE2V.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";var X=(()=>{let n=class n{constructor(t){this.http=t,this.apiUrl=`${q.apiUrl}/facturas`}obtenerFacturas(t){let e=new C;return t&&Object.keys(t).forEach(s=>{t[s]!==null&&t[s]!==void 0&&(e=e.set(s,t[s].toString()))}),this.http.get(this.apiUrl,{params:e})}obtenerFacturaPorId(t){return this.http.get(`${this.apiUrl}/${t}`)}obtenerFacturaPorNumero(t){return this.http.get(`${this.apiUrl}/numero/${t}`)}crearFactura(t){return this.http.post(this.apiUrl,t)}agregarDano(t,e){return this.http.post(`${this.apiUrl}/${t}/danos`,e)}registrarPago(t,e){return this.http.post(`${this.apiUrl}/${t}/pagos`,e)}anularFactura(t,e){return this.http.patch(`${this.apiUrl}/${t}/anular`,{motivo:e})}autoGenerarFacturas(){return this.http.post(`${this.apiUrl}/auto-generar`,{})}};n.\u0275fac=function(e){return new(e||n)(_(y))},n.\u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function nt(r,n){r&1&&(a(0,"div",8),d(1,"ion-spinner"),i())}function rt(r,n){if(r&1&&(a(0,"p"),u(1),i()),r&2){let c=p().$implicit;o(),f("M\xE9todo: ",c.metodoPago)}}function at(r,n){if(r&1&&(a(0,"ion-card")(1,"ion-card-header")(2,"div",10)(3,"ion-card-title"),u(4),i(),a(5,"ion-badge",11),u(6),i()()(),a(7,"ion-card-content")(8,"ion-item",12),d(9,"ion-icon",13),a(10,"ion-label")(11,"p"),u(12),i(),m(13,rt,2,1,"p",7),i()(),a(14,"div",14),d(15,"ion-icon",15),a(16,"strong"),u(17),i()()()()),r&2){let c=n.$implicit,t=p(2);o(4),h(c.numeroFactura),o(),l("color",t.obtenerColorEstado(c.estadoPago)),o(),f(" ",c.estadoPago," "),o(6),f("Fecha: ",t.formatearFecha(c.fechaEmision)),o(),l("ngIf",c.metodoPago),o(4),h(t.formatearMoneda(c.total))}}function it(r,n){if(r&1&&(a(0,"ion-list"),m(1,at,18,6,"ion-card",9),i()),r&2){let c=p();o(),l("ngForOf",c.facturas)}}var gt=(()=>{let n=class n{constructor(t){this.facturaService=t,this.facturas=[],this.cargando=!1,A({documentsOutline:K,cashOutline:J,refreshOutline:Q})}ngOnInit(){this.cargarFacturas()}ionViewWillEnter(){this.cargarFacturas()}cargarFacturas(t){this.cargando=!0,this.facturaService.obtenerFacturas().subscribe({next:e=>{e.success&&e.data&&(this.facturas=e.data),this.cargando=!1,t&&t.target.complete()},error:e=>{console.error("Error:",e),this.cargando=!1,t&&t.target.complete()}})}obtenerColorEstado(t){return{pendiente:"warning",pagada:"success",parcial:"tertiary",anulada:"danger"}[t]||"medium"}formatearFecha(t){return new Date(t).toLocaleDateString("es-EC")}formatearMoneda(t){return new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t)}autoGenerarFacturas(){this.cargando=!0,this.facturaService.autoGenerarFacturas().subscribe({next:t=>{console.log("Facturas generadas:",t),alert(`${t.message}`),this.cargarFacturas()},error:t=>{console.error("Error:",t),alert("Error al generar facturas"),this.cargando=!1}})}};n.\u0275fac=function(e){return new(e||n)(F(X))},n.\u0275cmp=x({type:n,selectors:[["app-facturas"]],decls:14,vars:3,consts:[["slot","start"],["defaultHref","/dashboard"],["slot","end"],[3,"click","disabled"],["slot","icon-only","name","refresh-outline"],["slot","fixed",3,"ionRefresh"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],[4,"ngFor","ngForOf"],[1,"header-content"],[3,"color"],["lines","none"],["name","documents-outline","slot","start"],[1,"total"],["name","cash-outline"]],template:function(e,s){e&1&&(a(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d(3,"ion-back-button",1),i(),a(4,"ion-title"),u(5,"Facturas"),i(),a(6,"ion-buttons",2)(7,"ion-button",3),g("click",function(){return s.autoGenerarFacturas()}),d(8,"ion-icon",4),i()()()(),a(9,"ion-content")(10,"ion-refresher",5),g("ionRefresh",function(Z){return s.cargarFacturas(Z)}),d(11,"ion-refresher-content"),i(),m(12,nt,2,0,"div",6)(13,it,2,1,"ion-list",7),i()),e&2&&(o(7),l("disabled",s.cargando),o(5),l("ngIf",s.cargando),o(),l("ngIf",!s.cargando))},dependencies:[E,b,v,S,B,V,z,D,M,P,k,U,j,w,T,H,R,$,W,G,N,L,O],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}ion-card[_ngcontent-%COMP%]{margin:12px}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.total[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid var(--ion-color-light);font-size:1.2rem;color:var(--ion-color-success)}"]});let r=n;return r})();export{gt as FacturasPage};
