import{M as h,O as c,Ya as l,a as o,d as i,e as n,f as u}from"./chunk-B4HSYOOP.js";var S=(()=>{let r=class r{constructor(t){this.http=t,this.apiUrl=l.apiUrl,this.tokenKey="auth_token";let e=this.getUserFromStorage();this.currentUserSubject=new o(e),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}get token(){return localStorage.getItem(this.tokenKey)}login(t){return this.http.post(`${this.apiUrl}/auth/login`,t).pipe(i(e=>{e.success&&e.data&&this.setSession(e.data.usuario,e.data.token)}))}verify2FA(t,e){return this.http.post(`${this.apiUrl}/auth/verify-2fa`,{userId:t,token:e}).pipe(i(a=>{a.success&&a.data&&this.setSession(a.data.usuario,a.data.token)}))}register(t){return this.http.post(`${this.apiUrl}/auth/register`,t).pipe(i(e=>{e.success&&e.data&&this.setSession(e.data.usuario,e.data.token)}))}logout(){localStorage.removeItem(this.tokenKey),localStorage.removeItem("current_user"),this.currentUserSubject.next(null)}getMe(){return this.http.get(`${this.apiUrl}/auth/me`).pipe(i(t=>{t.success&&t.data&&(this.currentUserSubject.next(t.data),this.saveUserToStorage(t.data))}))}enable2FA(){return this.http.post(`${this.apiUrl}/auth/enable-2fa`,{})}confirm2FA(t){return this.http.post(`${this.apiUrl}/auth/confirm-2fa`,{token:t})}disable2FA(t){return this.http.post(`${this.apiUrl}/auth/disable-2fa`,{password:t})}isAuthenticated(){return!!this.token}isAdmin(){return this.currentUserValue?.rol==="admin"}setSession(t,e){localStorage.setItem(this.tokenKey,e),this.saveUserToStorage(t),this.currentUserSubject.next(t)}saveUserToStorage(t){localStorage.setItem("current_user",JSON.stringify(t))}getUserFromStorage(){let t=localStorage.getItem("current_user");if(t)try{return JSON.parse(t)}catch{return null}return null}getAuthHeaders(){let t=this.token;return new h({"Content-Type":"application/json",Authorization:`Bearer ${t}`})}actualizarFotoPerfil(t){let e=this.currentUserValue;e&&(e.fotoPerfil=t,this.saveUserToStorage(e),this.currentUserSubject.next(e))}};r.\u0275fac=function(e){return new(e||r)(u(c))},r.\u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{S as a};
