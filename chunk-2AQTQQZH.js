import{B as b,C as R,D as P,Gb as Y,Ha as A,I as O,Ja as L,K as M,La as V,N as v,Na as G,O as D,Ra as q,Ua as J,Ya as K,Z as T,Za as Q,aa as y,e as I,ea as F,f as _,ha as w,k as l,l as S,m as E,mb as X,n as f,na as j,o as p,oa as k,p as t,pa as N,q as n,qa as U,r as m,ra as B,sa as H,t as h,u,ua as W,w as i,x as d,xa as $,y as C,za as z}from"./chunk-76QKIYJX.js";import"./chunk-MWWENCHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-JV5DO3IJ.js";import"./chunk-L3SNWROS.js";import"./chunk-EYYNAE2V.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";var Z=(()=>{let c=class c{constructor(e){this.http=e,this.apiUrl=`${K.apiUrl}/reportes`}reporteReservas(e){let o=new v;return Object.keys(e).forEach(a=>{e[a]&&(o=o.set(a,e[a]))}),this.http.get(`${this.apiUrl}/reservas`,{params:o})}reporteFinanciero(e){let o=new v;return Object.keys(e).forEach(a=>{e[a]&&(o=o.set(a,e[a]))}),this.http.get(`${this.apiUrl}/financiero`,{params:o})}reporteOcupacion(e){let o=new v;return Object.keys(e).forEach(a=>{e[a]&&(o=o.set(a,e[a]))}),this.http.get(`${this.apiUrl}/ocupacion`,{params:o})}reporteClientes(e){let o=new v;return e&&Object.keys(e).forEach(a=>{e[a]!==void 0&&(o=o.set(a,e[a].toString()))}),this.http.get(`${this.apiUrl}/clientes`,{params:o})}};c.\u0275fac=function(o){return new(o||c)(_(D))},c.\u0275prov=I({token:c,factory:c.\u0275fac,providedIn:"root"});let s=c;return s})();function ne(s,c){s&1&&(t(0,"div",12),m(1,"ion-spinner"),n())}function ie(s,c){if(s&1&&(t(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),m(4,"ion-icon",15),i(5," Reporte de Reservas "),n()(),t(6,"ion-card-content")(7,"div",16)(8,"div",17)(9,"h3"),i(10),n(),t(11,"p"),i(12,"Total Reservas"),n()(),t(13,"div",17)(14,"h3"),i(15),n(),t(16,"p"),i(17,"Confirmadas"),n()(),t(18,"div",17)(19,"h3"),i(20),n(),t(21,"p"),i(22,"Completadas"),n()(),t(23,"div",17)(24,"h3"),i(25),n(),t(26,"p"),i(27,"Canceladas"),n()(),t(28,"div",17)(29,"h3"),i(30),n(),t(31,"p"),i(32,"Ingresos Totales"),n()(),t(33,"div",17)(34,"h3"),i(35),n(),t(36,"p"),i(37,"Promedio por Reserva"),n()()()()()()),s&2){let r=u(2);l(10),d(r.datos.totalReservas||0),l(5),d(r.datos.confirmadas||0),l(5),d(r.datos.completadas||0),l(5),d(r.datos.canceladas||0),l(5),d(r.formatearMoneda(r.datos.totalIngresos||0)),l(5),d(r.formatearMoneda(r.datos.promedioIngreso||0))}}function oe(s,c){if(s&1&&(t(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),m(4,"ion-icon",15),i(5," Reporte Financiero "),n()(),t(6,"ion-card-content")(7,"div",16)(8,"div",17)(9,"h3"),i(10),n(),t(11,"p"),i(12,"Ingresos Totales"),n()(),t(13,"div",17)(14,"h3"),i(15),n(),t(16,"p"),i(17,"Facturas Pagadas"),n()(),t(18,"div",17)(19,"h3"),i(20),n(),t(21,"p"),i(22,"Facturas Pendientes"),n()()()()()()),s&2){let r=u(2);l(10),d(r.formatearMoneda(r.datos.ingresosTotales||0)),l(5),d(r.formatearMoneda(r.datos.facturasPagadas||0)),l(5),d(r.formatearMoneda(r.datos.facturasPendientes||0))}}function ae(s,c){if(s&1&&(t(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),m(4,"ion-icon",15),i(5," Reporte de Ocupaci\xF3n "),n()(),t(6,"ion-card-content")(7,"div",16)(8,"div",17)(9,"h3"),i(10),n(),t(11,"p"),i(12,"Tasa de Ocupaci\xF3n"),n()(),t(13,"div",17)(14,"h3"),i(15),n(),t(16,"p"),i(17,"D\xEDas Ocupados"),n()(),t(18,"div",17)(19,"h3"),i(20),n(),t(21,"p"),i(22,"D\xEDas Disponibles"),n()()()()()()),s&2){let r=u(2);l(10),C("",r.datos.tasaOcupacion||0,"%"),l(5),d(r.datos.diasOcupados||0),l(5),d(r.datos.diasDisponibles||0)}}function re(s,c){if(s&1&&(t(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),m(4,"ion-icon",15),i(5," Reporte de Clientes "),n()(),t(6,"ion-card-content")(7,"div",16)(8,"div",17)(9,"h3"),i(10),n(),t(11,"p"),i(12,"Total Clientes"),n()(),t(13,"div",17)(14,"h3"),i(15),n(),t(16,"p"),i(17,"Clientes Frecuentes"),n()(),t(18,"div",17)(19,"h3"),i(20),n(),t(21,"p"),i(22,"Clientes Nuevos (30d)"),n()()()()()()),s&2){let r=u(2);l(10),d(r.datos.totalClientes||0),l(5),d(r.datos.clientesFrecuentes||0),l(5),d(r.datos.clientesNuevos||0)}}function se(s,c){if(s&1&&(t(0,"div",13),f(1,ie,38,6,"div",14)(2,oe,23,3,"div",14)(3,ae,23,3,"div",14)(4,re,23,3,"div",14),n()),s&2){let r=u();l(),p("ngIf",r.tipoReporte==="reservas"),l(),p("ngIf",r.tipoReporte==="financiero"),l(),p("ngIf",r.tipoReporte==="ocupacion"),l(),p("ngIf",r.tipoReporte==="clientes")}}var xe=(()=>{let c=class c{constructor(e){this.reporteService=e,this.tipoReporte="reservas",this.cargando=!1,this.datos=null,Q({downloadOutline:X,statsChartOutline:Y})}ngOnInit(){this.generarReporte()}cambiarTipo(e){this.tipoReporte=e.detail.value,this.generarReporte()}generarReporte(){this.cargando=!0,this.datos=null;let e={},o;switch(this.tipoReporte){case"reservas":o=this.reporteService.reporteReservas(e);break;case"financiero":o=this.reporteService.reporteFinanciero(e);break;case"ocupacion":o=this.reporteService.reporteOcupacion({});break;case"clientes":o=this.reporteService.reporteClientes();break}o.subscribe({next:a=>{console.log("Respuesta completa del backend:",a),console.log("Tipo de reporte:",this.tipoReporte),a.success?(console.log("Data antes de procesar:",a.data),this.datos=this.procesarDatos(a.data),console.log("Datos procesados:",this.datos)):console.error("Respuesta no exitosa:",a),this.cargando=!1},error:a=>{console.error("Error al cargar reporte:",a),console.error("Detalles del error:",a.error),this.cargando=!1}})}procesarDatos(e){switch(this.tipoReporte){case"reservas":return{totalReservas:e.estadisticas?.totalReservas||0,confirmadas:e.estadisticas?.reservasPorEstado?.find(o=>o._id==="confirmada")?.count||0,completadas:e.estadisticas?.reservasPorEstado?.find(o=>o._id==="completada")?.count||0,canceladas:e.estadisticas?.reservasPorEstado?.find(o=>o._id==="cancelada")?.count||0,totalIngresos:e.estadisticas?.totalIngresos||0,promedioIngreso:e.estadisticas?.promedioIngreso||0,reservas:e.reservas||[]};case"financiero":return{ingresosTotales:e.estadisticas?.totalIngresos||0,facturasPagadas:e.estadisticas?.facturasPorEstado?.find(o=>o._id==="pagada")?.total||0,facturasPendientes:e.estadisticas?.totalPendiente||0,totalFacturas:e.estadisticas?.totalFacturas||0,totalIVA:e.estadisticas?.totalIVA||0,totalDescuentos:e.estadisticas?.totalDescuentos||0,totalDanos:e.estadisticas?.totalDanos||0,facturas:e.facturas||[]};case"ocupacion":return{tasaOcupacion:e.tasaOcupacionGeneral||0,diasOcupados:e.totalDiasOcupados||0,diasDisponibles:e.totalDiasDisponibles-(e.totalDiasOcupados||0),periodo:e.periodo,ocupacionPorDepartamento:e.ocupacionPorDepartamento||[]};case"clientes":return{totalClientes:e.totalClientes||0,clientesFrecuentes:e.clientesFrecuentes||0,clientesNuevos:e.clientesNuevos||0,topClientes:e.topClientes||[]};default:return e}}descargarReporte(){console.log("Descargando reporte...")}formatearMoneda(e){return new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(e)}};c.\u0275fac=function(o){return new(o||c)(S(Z))},c.\u0275cmp=E({type:c,selectors:[["app-reportes"]],decls:26,vars:4,consts:[["slot","start"],["defaultHref","/dashboard"],["slot","end"],[3,"click","disabled"],["name","download-outline"],[3,"ngModelChange","ionChange","ngModel"],["value","reservas"],["value","financiero"],["value","ocupacion"],["value","clientes"],["class","loading-container",4,"ngIf"],["class","reporte-container",4,"ngIf"],[1,"loading-container"],[1,"reporte-container"],[4,"ngIf"],["name","stats-chart-outline"],[1,"stats-grid"],[1,"stat-item"]],template:function(o,a){o&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),m(3,"ion-back-button",1),n(),t(4,"ion-title"),i(5,"Reportes"),n(),t(6,"ion-buttons",2)(7,"ion-button",3),h("click",function(){return a.descargarReporte()}),m(8,"ion-icon",4),n()()(),t(9,"ion-toolbar")(10,"ion-segment",5),P("ngModelChange",function(g){return R(a.tipoReporte,g)||(a.tipoReporte=g),g}),h("ionChange",function(g){return a.cambiarTipo(g)}),t(11,"ion-segment-button",6)(12,"ion-label"),i(13,"Reservas"),n()(),t(14,"ion-segment-button",7)(15,"ion-label"),i(16,"Financiero"),n()(),t(17,"ion-segment-button",8)(18,"ion-label"),i(19,"Ocupaci\xF3n"),n()(),t(20,"ion-segment-button",9)(21,"ion-label"),i(22,"Clientes"),n()()()()(),t(23,"ion-content"),f(24,ne,2,0,"div",10)(25,se,5,4,"div",11),n()),o&2&&(l(7),p("disabled",!a.datos),l(3),b("ngModel",a.tipoReporte),l(14),p("ngIf",a.cargando),l(),p("ngIf",!a.cargando&&a.datos))},dependencies:[M,O,F,T,y,$,G,V,W,k,w,N,B,H,U,j,q,J,A,z,L],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.reporte-container[_ngcontent-%COMP%]{padding:16px}ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{text-align:center;padding:20px;background:var(--ion-color-light);border-radius:12px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--ion-color-primary);margin:0 0 8px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium);margin:0}"]});let s=c;return s})();export{xe as ReportesPage};
