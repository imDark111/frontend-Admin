import{a as re}from"./chunk-55OPF5ZB.js";import{a as $}from"./chunk-VLQAVE7D.js";import{Aa as q,B as f,C as w,D as h,Db as ae,I,K as V,La as J,Ma as K,Na as Q,Ra as X,Sa as Y,Xa as Z,Z as F,Za as ee,aa as k,ea as D,gb as te,h as c,ha as O,i as u,j as M,k as r,l as y,la as W,m as S,n as P,na as U,o as m,oa as A,p as i,pa as N,q as o,qa as j,r as x,ra as B,rb as ie,s as C,sa as L,t as g,u as s,ua as z,v as T,vb as ne,w as l,x as b,xa as H,y as E,ya as R,yb as oe,za as G}from"./chunk-76QKIYJX.js";import"./chunk-MWWENCHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-JV5DO3IJ.js";import"./chunk-L3SNWROS.js";import"./chunk-EYYNAE2V.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function se(d,_){if(d&1){let t=C();i(0,"ion-item")(1,"ion-label",16),l(2,"Tel\xE9fono"),o(),i(3,"ion-input",27),h("ngModelChange",function(e){c(t);let a=s(2);return w(a.usuario.telefono,e)||(a.usuario.telefono=e),u(e)}),o()()}if(d&2){let t=s(2);r(3),f("ngModel",t.usuario.telefono),m("readonly",!t.editando)}}function le(d,_){if(d&1){let t=C();i(0,"ion-item")(1,"ion-label",16),l(2,"Direcci\xF3n"),o(),i(3,"ion-input",28),h("ngModelChange",function(e){c(t);let a=s(2);return w(a.usuario.direccion,e)||(a.usuario.direccion=e),u(e)}),o()()}if(d&2){let t=s(2);r(3),f("ngModel",t.usuario.direccion),m("readonly",!t.editando)}}function de(d,_){if(d&1){let t=C();i(0,"ion-button",29),g("click",function(){c(t);let e=s(2);return u(e.guardarCambios())}),l(1," Guardar Cambios "),o()}}function ce(d,_){if(d&1){let t=C();i(0,"div",30)(1,"ion-item")(2,"ion-label",16),l(3,"Contrase\xF1a Actual"),o(),i(4,"ion-input",31),h("ngModelChange",function(e){c(t);let a=s(2);return w(a.passwordData.passwordActual,e)||(a.passwordData.passwordActual=e),u(e)}),o()(),i(5,"ion-item")(6,"ion-label",16),l(7,"Nueva Contrase\xF1a"),o(),i(8,"ion-input",32),h("ngModelChange",function(e){c(t);let a=s(2);return w(a.passwordData.passwordNueva,e)||(a.passwordData.passwordNueva=e),u(e)}),o()(),i(9,"ion-item")(10,"ion-label",16),l(11,"Confirmar Contrase\xF1a"),o(),i(12,"ion-input",33),h("ngModelChange",function(e){c(t);let a=s(2);return w(a.passwordData.confirmarPassword,e)||(a.passwordData.confirmarPassword=e),u(e)}),o()(),i(13,"ion-button",29),g("click",function(){c(t);let e=s(2);return u(e.guardarPassword())}),l(14," Cambiar Contrase\xF1a "),o()()}if(d&2){let t=s(2);r(4),f("ngModel",t.passwordData.passwordActual),r(4),f("ngModel",t.passwordData.passwordNueva),r(4),f("ngModel",t.passwordData.confirmarPassword)}}function ue(d,_){if(d&1){let t=C();i(0,"div",5)(1,"ion-card",6)(2,"ion-card-content")(3,"div",7)(4,"ion-avatar",8),x(5,"img",9),o(),i(6,"ion-button",10),g("click",function(){c(t);let e=T(8);return u(e.click())}),i(7,"input",11,0),g("change",function(e){c(t);let a=s();return u(a.cambiarFoto(e))}),o(),x(9,"ion-icon",12),o()(),i(10,"h2"),l(11),o(),i(12,"p"),l(13),o()()(),i(14,"ion-card")(15,"ion-card-header")(16,"div",13)(17,"ion-card-title"),l(18,"Informaci\xF3n Personal"),o(),i(19,"ion-button",14),g("click",function(){c(t);let e=s();return u(e.editando=!e.editando)}),l(20),o()()(),i(21,"ion-card-content")(22,"ion-list")(23,"ion-item"),x(24,"ion-icon",15),i(25,"ion-label",16),l(26,"Nombre de Usuario"),o(),i(27,"ion-input",17),h("ngModelChange",function(e){c(t);let a=s();return w(a.usuario.nombreUsuario,e)||(a.usuario.nombreUsuario=e),u(e)}),o()(),i(28,"ion-item"),x(29,"ion-icon",18),i(30,"ion-label",16),l(31,"Email"),o(),i(32,"ion-input",19),h("ngModelChange",function(e){c(t);let a=s();return w(a.usuario.email,e)||(a.usuario.email=e),u(e)}),o()(),P(33,se,4,2,"ion-item",20)(34,le,4,2,"ion-item",20),o(),P(35,de,2,0,"ion-button",21),o()(),i(36,"ion-card")(37,"ion-card-header")(38,"ion-card-title"),l(39,"Seguridad"),o()(),i(40,"ion-card-content")(41,"ion-list")(42,"ion-item"),x(43,"ion-icon",22),i(44,"ion-label")(45,"h3"),l(46,"Autenticaci\xF3n de Dos Factores"),o(),i(47,"p"),l(48),o()(),i(49,"ion-toggle",23),h("ngModelChange",function(e){c(t);let a=s();return w(a.usuario.twoFactorEnabled,e)||(a.usuario.twoFactorEnabled=e),u(e)}),g("ionChange",function(){c(t);let e=s();return u(e.toggle2FA())}),o()(),i(50,"ion-item",24),g("click",function(){c(t);let e=s();return u(e.cambiarPassword=!e.cambiarPassword)}),x(51,"ion-icon",25),i(52,"ion-label")(53,"h3"),l(54,"Cambiar Contrase\xF1a"),o()()()(),P(55,ce,15,3,"div",26),o()()()}if(d&2){let t=s();r(5),m("src",t.getUrlFoto(),M)("alt",t.usuario.nombreUsuario),r(6),b(t.usuario.nombreUsuario),r(2),b(t.usuario.email),r(7),E(" ",t.editando?"Cancelar":"Editar"," "),r(7),f("ngModel",t.usuario.nombreUsuario),m("readonly",!t.editando),r(5),f("ngModel",t.usuario.email),m("readonly",!t.editando),r(),m("ngIf",t.usuario.telefono),r(),m("ngIf",t.usuario.direccion),r(),m("ngIf",t.editando),r(13),b(t.usuario.twoFactorEnabled?"Activado":"Desactivado"),r(),f("ngModel",t.usuario.twoFactorEnabled),r(6),m("ngIf",t.cambiarPassword)}}var be=(()=>{let _=class _{constructor(n,e){this.authService=n,this.usuarioService=e,this.usuario=null,this.editando=!1,this.cambiarPassword=!1,this.passwordData={passwordActual:"",passwordNueva:"",confirmarPassword:""},this.mostrarToast=!1,this.mensajeToast="",ee({personOutline:oe,mailOutline:ne,cameraOutline:te,keyOutline:ie,shieldCheckmarkOutline:ae})}ngOnInit(){this.authService.currentUser.subscribe(n=>{this.usuario=n})}cambiarFoto(n){let e=n.target.files[0];if(e){console.log("\u{1F4F8} Archivo seleccionado:",e.name,e.type,e.size);let a=new FormData;a.append("fotoPerfil",e),this.usuarioService.cambiarFoto(a).subscribe({next:p=>{if(console.log("\u2705 Respuesta del servidor:",p),p.success&&(this.mensajeToast="Foto actualizada exitosamente",this.mostrarToast=!0,this.usuario&&p.data&&p.data.fotoPerfil)){let v=p.data.fotoPerfil;console.log("\u{1F5BC}\uFE0F Nueva foto URL:",v),this.usuario.fotoPerfil=v+"?t="+new Date().getTime(),this.authService.actualizarFotoPerfil(v)}},error:p=>{console.error("\u274C Error al actualizar foto:",p),this.mensajeToast=p.error?.message||"Error al actualizar foto",this.mostrarToast=!0}})}}guardarCambios(){this.usuario&&this.usuarioService.actualizarUsuario(this.usuario.id,this.usuario).subscribe({next:n=>{n.success&&(this.mensajeToast="Perfil actualizado exitosamente",this.mostrarToast=!0,this.editando=!1)},error:n=>{this.mensajeToast="Error al actualizar perfil",this.mostrarToast=!0}})}guardarPassword(){if(this.passwordData.passwordNueva!==this.passwordData.confirmarPassword){this.mensajeToast="Las contrase\xF1as no coinciden",this.mostrarToast=!0;return}this.usuarioService.cambiarPassword({passwordActual:this.passwordData.passwordActual,passwordNueva:this.passwordData.passwordNueva}).subscribe({next:n=>{n.success&&(this.mensajeToast="Contrase\xF1a actualizada exitosamente",this.mostrarToast=!0,this.cambiarPassword=!1,this.passwordData={passwordActual:"",passwordNueva:"",confirmarPassword:""})},error:n=>{this.mensajeToast="Error al cambiar contrase\xF1a",this.mostrarToast=!0}})}toggle2FA(){this.mensajeToast="Funcionalidad 2FA en desarrollo",this.mostrarToast=!0}getUrlFoto(){if(!this.usuario?.fotoPerfil)return`https://ui-avatars.com/api/?name=${encodeURIComponent(this.usuario?.nombreUsuario||"User")}&background=1b5e20&color=fff&size=200`;let n=this.usuario.fotoPerfil;return n.startsWith("http://")||n.startsWith("https://")?n:`http://192.168.0.11:3000${n.startsWith("/")?n:"/"+n}`}};_.\u0275fac=function(e){return new(e||_)(y($),y(re))},_.\u0275cmp=S({type:_,selectors:[["app-perfil"]],decls:9,vars:4,consts:[["fileInput",""],["slot","start"],["defaultHref","/dashboard"],["class","perfil-container",4,"ngIf"],[3,"didDismiss","isOpen","message","duration"],[1,"perfil-container"],[1,"foto-card"],[1,"foto-container"],[1,"avatar-large"],[3,"src","alt"],["fill","clear",1,"cambiar-foto-btn",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["name","camera-outline"],[1,"card-header"],["fill","clear",3,"click"],["name","person-outline","slot","start"],["position","stacked"],["placeholder","Nombre de usuario",3,"ngModelChange","ngModel","readonly"],["name","mail-outline","slot","start"],["type","email","placeholder","Email",3,"ngModelChange","ngModel","readonly"],[4,"ngIf"],["expand","block","class","save-btn",3,"click",4,"ngIf"],["name","shield-checkmark-outline","slot","start"],[3,"ngModelChange","ionChange","ngModel"],["button","",3,"click"],["name","key-outline","slot","start"],["class","password-form",4,"ngIf"],["placeholder","Tel\xE9fono",3,"ngModelChange","ngModel","readonly"],["placeholder","Direcci\xF3n",3,"ngModelChange","ngModel","readonly"],["expand","block",1,"save-btn",3,"click"],[1,"password-form"],["type","password","placeholder","Contrase\xF1a actual",3,"ngModelChange","ngModel"],["type","password","placeholder","Nueva contrase\xF1a",3,"ngModelChange","ngModel"],["type","password","placeholder","Confirmar contrase\xF1a",3,"ngModelChange","ngModel"]],template:function(e,a){e&1&&(i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),x(3,"ion-back-button",2),o(),i(4,"ion-title"),l(5,"Mi Perfil"),o()()(),i(6,"ion-content"),P(7,ue,56,15,"div",3),i(8,"ion-toast",4),g("didDismiss",function(){return a.mostrarToast=!1}),o()()),e&2&&(r(7),m("ngIf",a.usuario),r(),m("isOpen",a.mostrarToast)("message",a.mensajeToast)("duration",3e3))},dependencies:[V,I,D,F,k,H,Q,J,z,A,O,N,B,L,j,q,R,G,Y,U,X,W,Z,K],styles:[".perfil-container[_ngcontent-%COMP%]{padding:16px;max-width:600px;margin:0 auto}.foto-card[_ngcontent-%COMP%]{text-align:center}.foto-card[_ngcontent-%COMP%]   .foto-container[_ngcontent-%COMP%]{position:relative;display:inline-block;margin-bottom:16px}.foto-card[_ngcontent-%COMP%]   .foto-container[_ngcontent-%COMP%]   .avatar-large[_ngcontent-%COMP%]{width:120px;height:120px}.foto-card[_ngcontent-%COMP%]   .foto-container[_ngcontent-%COMP%]   .cambiar-foto-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;--border-radius: 50%;--padding-start: 8px;--padding-end: 8px}.foto-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:8px 0;font-weight:600}.foto-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:4px 0}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.save-btn[_ngcontent-%COMP%]{margin-top:16px;--border-radius: 12px}.password-form[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid var(--ion-color-light)}ion-list[_ngcontent-%COMP%]{background:transparent}ion-item[_ngcontent-%COMP%]{--background: transparent}"]});let d=_;return d})();export{be as PerfilPage};
