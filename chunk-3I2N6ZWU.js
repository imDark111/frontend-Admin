import{a as X}from"./chunk-VLQAVE7D.js";import{$ as E,B as h,C as x,D as y,I as M,Ja as z,K as P,Ka as G,La as J,Na as K,Ra as Q,Sa as U,T as v,Z as b,Za as Y,_ as F,aa as A,ba as T,ca as V,da as L,ea as O,h as g,i as p,k as a,l as w,m as I,n as u,na as q,nb as Z,o as s,ob as $,p as n,pa as W,q as r,qa as N,r as f,ra as k,s as C,sa as D,t as _,tb as ee,u as c,ua as B,vb as te,w as d,x as S,xa as j,ya as H,za as R}from"./chunk-76QKIYJX.js";import"./chunk-MWWENCHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-JV5DO3IJ.js";import"./chunk-L3SNWROS.js";import"./chunk-EYYNAE2V.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-G7SWQJ6W.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function ie(e,l){e&1&&(n(0,"p"),d(1,"Panel de Administraci\xF3n"),r())}function ne(e,l){e&1&&(n(0,"p"),d(1,"Verificaci\xF3n 2FA"),r())}function oe(e,l){if(e&1&&(n(0,"ion-text",17)(1,"p",4),d(2),r()()),e&2){let t=c(2);a(2),S(t.errorMessage)}}function re(e,l){e&1&&f(0,"ion-spinner",18)}function ae(e,l){e&1&&(n(0,"span"),d(1,"Iniciar Sesi\xF3n"),r())}function se(e,l){if(e&1){let t=C();n(0,"form",7),_("ngSubmit",function(){g(t);let i=c();return p(i.onSubmit())}),n(1,"ion-item"),f(2,"ion-icon",8),n(3,"ion-label",9),d(4,"Email"),r(),n(5,"ion-input",10),y("ngModelChange",function(i){g(t);let m=c();return x(m.email,i)||(m.email=i),p(i)}),r()(),n(6,"ion-item"),f(7,"ion-icon",11),n(8,"ion-label",9),d(9,"Contrase\xF1a"),r(),n(10,"ion-input",12),y("ngModelChange",function(i){g(t);let m=c();return x(m.password,i)||(m.password=i),p(i)}),r(),n(11,"ion-icon",13),_("click",function(){g(t);let i=c();return p(i.togglePasswordVisibility())}),r()(),u(12,oe,3,1,"ion-text",14),n(13,"ion-button",15),u(14,re,1,0,"ion-spinner",16)(15,ae,2,0,"span",5),r()()}if(e&2){let t=c();a(5),h("ngModel",t.email),a(5),s("type",t.showPassword?"text":"password"),h("ngModel",t.password),a(),s("name",t.showPassword?"eye-off-outline":"eye-outline"),a(),s("ngIf",t.errorMessage),a(),s("disabled",t.loading),a(),s("ngIf",t.loading),a(),s("ngIf",!t.loading)}}function le(e,l){if(e&1&&(n(0,"ion-text",17)(1,"p",4),d(2),r()()),e&2){let t=c(2);a(2),S(t.errorMessage)}}function me(e,l){e&1&&f(0,"ion-spinner",18)}function de(e,l){e&1&&(n(0,"span"),d(1,"Verificar"),r())}function ce(e,l){if(e&1){let t=C();n(0,"form",7),_("ngSubmit",function(){g(t);let i=c();return p(i.verify2FA())}),n(1,"ion-item")(2,"ion-label",9),d(3,"C\xF3digo 2FA"),r(),n(4,"ion-input",19),y("ngModelChange",function(i){g(t);let m=c();return x(m.code2FA,i)||(m.code2FA=i),p(i)}),r()(),u(5,le,3,1,"ion-text",14),n(6,"ion-button",15),u(7,me,1,0,"ion-spinner",16)(8,de,2,0,"span",5),r()()}if(e&2){let t=c();a(4),h("ngModel",t.code2FA),a(),s("ngIf",t.errorMessage),a(),s("disabled",t.loading),a(),s("ngIf",t.loading),a(),s("ngIf",!t.loading)}}var Se=(()=>{let l=class l{constructor(o,i){this.authService=o,this.router=i,this.email="",this.password="",this.showPassword=!1,this.loading=!1,this.errorMessage="",this.requires2FA=!1,this.userId="",this.code2FA="",Y({mailOutline:te,lockClosedOutline:ee,eyeOutline:$,eyeOffOutline:Z})}ngOnInit(){this.authService.isAuthenticated()&&this.router.navigate(["/dashboard"])}togglePasswordVisibility(){this.showPassword=!this.showPassword}onSubmit(){if(!this.email||!this.password){this.errorMessage="Por favor complete todos los campos";return}this.loading=!0,this.errorMessage="",this.authService.login({email:this.email,password:this.password}).subscribe({next:o=>{if(this.loading=!1,o.requiresTwoFactor)this.requires2FA=!0,this.userId=o.userId||"";else if(o.success&&o.data){if(o.data.usuario.rol!=="admin"){this.errorMessage="Este panel es solo para administradores",this.authService.logout();return}this.router.navigate(["/dashboard"])}},error:o=>{this.loading=!1,this.errorMessage=o.error?.message||"Error al iniciar sesi\xF3n"}})}verify2FA(){if(!this.code2FA){this.errorMessage="Por favor ingrese el c\xF3digo 2FA";return}this.loading=!0,this.errorMessage="",this.authService.verify2FA(this.userId,this.code2FA).subscribe({next:o=>{if(this.loading=!1,o.success&&o.data){if(o.data.usuario.rol!=="admin"){this.errorMessage="Este panel es solo para administradores",this.authService.logout();return}this.router.navigate(["/dashboard"])}},error:o=>{this.loading=!1,this.errorMessage=o.error?.message||"C\xF3digo 2FA inv\xE1lido"}})}};l.\u0275fac=function(i){return new(i||l)(w(X),w(v))},l.\u0275cmp=I({type:l,selectors:[["app-login"]],decls:18,vars:6,consts:[[3,"translucent"],["color","primary"],[1,"ion-padding",3,"fullscreen"],[1,"login-container"],[1,"ion-text-center"],[4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[3,"ngSubmit"],["name","mail-outline","slot","start"],["position","floating"],["type","email","name","email","required","","autocomplete","email",3,"ngModelChange","ngModel"],["name","lock-closed-outline","slot","start"],["name","password","required","",3,"ngModelChange","type","ngModel"],["slot","end",2,"cursor","pointer",3,"click","name"],["color","danger",4,"ngIf"],["expand","block","type","submit",1,"ion-margin-top",3,"disabled"],["name","crescent",4,"ngIf"],["color","danger"],["name","crescent"],["type","text","name","code2FA","required","","maxlength","6",3,"ngModelChange","ngModel"]],template:function(i,m){i&1&&(n(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),d(3,"Para\xEDso Verde - Admin"),r()()(),n(4,"ion-content",2)(5,"div",3)(6,"ion-card")(7,"ion-card-header")(8,"ion-card-title",4)(9,"h1"),d(10,"\u{1F3E8}"),r(),n(11,"h2"),d(12,"Iniciar Sesi\xF3n"),r(),u(13,ie,2,0,"p",5)(14,ne,2,0,"p",5),r()(),n(15,"ion-card-content"),u(16,se,16,8,"form",6)(17,ce,9,5,"form",6),r()()()()),i&2&&(s("translucent",!0),a(4),s("fullscreen",!0),a(9),s("ngIf",!m.requires2FA),a(),s("ngIf",m.requires2FA),a(2),s("ngIf",!m.requires2FA),a(),s("ngIf",m.requires2FA))},dependencies:[P,M,O,T,b,F,V,L,A,E,B,j,J,K,W,k,D,N,H,R,U,q,Q,G,z],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:80vh}.login-container[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{width:100%;max-width:500px;margin:0 auto}.login-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:4rem;margin:0}.login-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.5rem}.login-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-bottom:1rem}"]});let e=l;return e})();export{Se as LoginPage};
